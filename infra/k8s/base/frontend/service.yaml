# =============================================================================
# SERVICE.YAML - FRONTEND SERVICE
# =============================================================================
# This Service exposes the frontend (nginx) pods within the cluster.
# The Ingress controller routes external traffic to this service.
#
# Traffic Flow:
# -------------
#   Internet → Ingress → Frontend Service → Frontend Pods (nginx)
#                                         ↓
#                               Serves React App
#                                         ↓
#                           React calls /api/* 
#                                         ↓
#                    Ingress routes /api/* → Backend Service
#
# The frontend service only needs to be accessible within the cluster
# because the Ingress handles external access.
#
# Commands:
#   kubectl apply -f service.yaml -n casino
#   kubectl get svc frontend -n casino
#   kubectl describe svc frontend -n casino
#   kubectl port-forward svc/frontend 5173:80 -n casino
# =============================================================================

apiVersion: v1
kind: Service
metadata:
  name: frontend
  namespace: casino
  labels:
    app.kubernetes.io/name: frontend
    app.kubernetes.io/component: web
    app.kubernetes.io/part-of: casino-capstone
  annotations:
    description: "Frontend service for Casino Capstone (nginx serving React app)"
spec:
  # Service type - ClusterIP for internal access
  # Ingress handles external routing
  type: ClusterIP
  
  # Selector - which pods this service routes to
  selector:
    app: frontend
    app.kubernetes.io/name: frontend
  
  # Ports configuration
  ports:
    - name: http
      port: 80            # Port the service listens on
      targetPort: http    # Named port on pod (80)
      protocol: TCP
  
  # Session affinity - None for stateless static content
  sessionAffinity: None

---
# =============================================================================
# OPTIONAL: NODEPORT SERVICE FOR LOCAL DEVELOPMENT
# =============================================================================
# Use this to access the frontend directly without an Ingress controller.
# Useful for local development with minikube, kind, or Docker Desktop.
#
# Access:
#   minikube: minikube service frontend-nodeport -n casino
#   kind/other: http://<node-ip>:30173
# =============================================================================

# apiVersion: v1
# kind: Service
# metadata:
#   name: frontend-nodeport
#   namespace: casino
#   labels:
#     app.kubernetes.io/name: frontend
#     app.kubernetes.io/component: web
# spec:
#   type: NodePort
#   selector:
#     app: frontend
#   ports:
#     - name: http
#       port: 80
#       targetPort: 80
#       nodePort: 30173  # Fixed port in range 30000-32767
#       protocol: TCP

---
# =============================================================================
# SERVICE CONFIGURATION NOTES
# =============================================================================
#
# DNS Resolution:
# ---------------
#   frontend                            (same namespace)
#   frontend.casino                     (from other namespaces)
#   frontend.casino.svc.cluster.local   (fully qualified)
#
#
# Testing the Service:
# --------------------
# Port forward to access locally:
#   kubectl port-forward svc/frontend 5173:80 -n casino
#   # Open http://localhost:5173
#
# From within a pod:
#   curl http://frontend.casino.svc.cluster.local
#
#
# With Minikube:
# --------------
# Use minikube tunnel for LoadBalancer services:
#   minikube tunnel
#
# Or use minikube service command for NodePort:
#   minikube service frontend-nodeport -n casino
#
#
# Checking Service Endpoints:
# ---------------------------
# kubectl get endpoints frontend -n casino
# # Shows IP addresses of all pods backing this service
#
#
# Debugging Service Issues:
# -------------------------
# 1. Check if pods are running:
#    kubectl get pods -l app=frontend -n casino
#
# 2. Check if endpoints are populated:
#    kubectl get endpoints frontend -n casino
#
# 3. Check service selectors match pod labels:
#    kubectl describe svc frontend -n casino
#    kubectl describe pod <pod-name> -n casino
#
# 4. Test connectivity from another pod:
#    kubectl run -it --rm debug --image=busybox -n casino -- wget -qO- http://frontend
#
# =============================================================================